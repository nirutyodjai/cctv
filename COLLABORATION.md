# CCTV Planner - การทำงานร่วมกันแบบ Real-time

## ภาพรวม

ระบบ CCTV Planner รองรับการทำงานร่วมกันแบบ real-time ผ่าน Socket.IO ทำให้หลายคนสามารถทำงานในแผนที่เดียวกันได้พร้อมกัน

## ฟีเจอร์การทำงานร่วมกัน

### 1. **ห้องทำงาน (Rooms)**
- แต่ละห้องมี Room ID เฉพาะ
- ผู้ใช้สามารถเข้าร่วมห้องได้โดยใช้ Room ID
- ข้อมูลในห้องจะ sync กันแบบ real-time

### 2. **การแชท (Chat)**
- แชทแบบ real-time ภายในห้อง
- แสดงข้อความพร้อมเวลาที่ส่ง
- แจ้งเตือนเมื่อมีผู้ใช้เข้าร่วม/ออกจากห้อง

### 3. **การ Sync ข้อมูล**
- กล้องที่เพิ่มจะปรากฏในทุกคนทันที
- ตู้ Rack และการเชื่อมต่อ sync แบบ real-time
- สี่เหลี่ยมโปร่งแสง sync กันทุกคน

### 4. **การแสดงผู้ร่วมงาน**
- แสดงรายชื่อผู้ใช้ในห้อง
- แสดงสถานะการเชื่อมต่อ
- แสดงจำนวนผู้ร่วมงาน

## วิธีใช้งาน

### การเริ่มต้น Server

1. **ติดตั้ง Dependencies**
```bash
npm install
```

2. **รัน Server**
```bash
npm start
# หรือ
npm run dev  # สำหรับ development
```

3. **เปิดเบราว์เซอร์**
```
http://localhost:3000
```

### การเข้าร่วมห้อง

1. **สร้างห้องใหม่**
   - เปิดแอปพลิเคชัน
   - ระบบจะสร้าง Room ID ให้อัตโนมัติ
   - คลิกปุ่ม "คัดลอก" เพื่อคัดลอก Room ID

2. **แชร์ Room ID**
   - ส่ง Room ID ให้เพื่อนร่วมงาน
   - เพื่อนสามารถเข้าร่วมได้โดยใส่ Room ID

3. **เข้าร่วมห้อง**
   - ใส่ชื่อผู้ใช้เมื่อเข้าร่วม
   - ระบบจะแสดงรายชื่อผู้ร่วมงาน

### การทำงานร่วมกัน

1. **เพิ่มกล้อง/อุปกรณ์**
   - เพิ่มกล้องหรือตู้ Rack ตามปกติ
   - การเปลี่ยนแปลงจะปรากฏในทุกคนทันที

2. **แชท**
   - ใช้แชทเพื่อสื่อสารกับทีม
   - ข้อความจะส่งแบบ real-time

3. **ดูผู้ร่วมงาน**
   - แสดงรายชื่อผู้ใช้ในห้อง
   - แสดงสถานะการเชื่อมต่อ

## การตั้งค่า

### Environment Variables
```bash
PORT=3000  # Port สำหรับ server
NODE_ENV=development  # Environment
```

### การ Deploy

1. **Heroku**
```bash
heroku create your-app-name
git push heroku main
```

2. **Vercel**
```bash
vercel --prod
```

3. **Docker**
```bash
docker build -t cctv-collaborative .
docker run -p 3000:3000 cctv-collaborative
```

## API Endpoints

### GET `/api/rooms`
- รายการห้องทั้งหมด
- จำนวนผู้ใช้ในแต่ละห้อง

### GET `/api/rooms/:roomId`
- ข้อมูลห้องเฉพาะ
- ข้อมูลแผนที่ในห้อง

### GET `/health`
- สถานะ server
- จำนวนห้องและผู้ใช้

## Socket.IO Events

### Client to Server
- `joinRoom` - เข้าร่วมห้อง
- `syncData` - ส่งข้อมูลการเปลี่ยนแปลง
- `chatMessage` - ส่งข้อความแชท
- `cursorMove` - ส่งตำแหน่ง cursor

### Server to Client
- `userJoined` - ผู้ใช้เข้าร่วม
- `userLeft` - ผู้ใช้ออกจากห้อง
- `dataSync` - ข้อมูลการเปลี่ยนแปลง
- `chatMessage` - ข้อความแชท
- `cursorMove` - ตำแหน่ง cursor ของผู้ร่วมงาน

## การแก้ไขปัญหา

### ปัญหาการเชื่อมต่อ
1. ตรวจสอบว่า server กำลังรันอยู่
2. ตรวจสอบ firewall settings
3. ตรวจสอบ network connection

### ปัญหาการ Sync
1. ตรวจสอบ Socket.IO connection
2. ตรวจสอบ console errors
3. รีเฟรชหน้าเว็บ

### ปัญหาการแชท
1. ตรวจสอบการเชื่อมต่อ server
2. ตรวจสอบ browser console
3. ลองเข้าร่วมห้องใหม่

## ความปลอดภัย

### การป้องกัน
- ใช้ HTTPS ใน production
- จำกัดจำนวนผู้ใช้ต่อห้อง
- ตรวจสอบ input validation

### การ Backup
- ข้อมูลห้องจะหายเมื่อ server restart
- ควร implement database สำหรับเก็บข้อมูลถาวร

## การพัฒนาต่อ

### ฟีเจอร์ที่อาจเพิ่ม
- การบันทึก/โหลดแผนที่
- การแชร์ลิงก์ห้อง
- การตั้งค่าสิทธิ์ผู้ใช้
- การ export/import ข้อมูล
- การบันทึกประวัติการเปลี่ยนแปลง
